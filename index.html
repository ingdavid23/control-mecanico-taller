<!doctype html>
<html lang="es" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gesti√≥n de Taller Mec√°nico</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-slide-in {
      animation: slideIn 0.3s ease-out;
    }
    
    @media print {
      body * {
        visibility: hidden;
      }
      #ticket-print, #ticket-print * {
        visibility: visible;
      }
      #ticket-print {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full overflow-auto"></div>
  <script>
    const config = {
      background_color: "#f0f4f8",
      surface_color: "#ffffff",
      text_color: "#1e293b",
      primary_action_color: "#2563eb",
      secondary_action_color: "#64748b",
      font_family: "sans-serif",
      font_size: 16,
      nombre_taller: "Auto Servicio Express",
      direccion_taller: "Av. Principal #123, Col. Centro",
      telefono_taller: "+52 555 123 4567"
    };

    let allRecords = [];
    let currentView = 'list';
    let currentRecord = null;
    const STORAGE_KEY = 'taller_mecanico_records';

    // Funciones de almacenamiento local
    function saveToLocalStorage() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(allRecords));
      } catch (e) {
        console.error('Error al guardar en localStorage:', e);
      }
    }

    function loadFromLocalStorage() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
          allRecords = JSON.parse(stored);
        }
      } catch (e) {
        console.error('Error al cargar desde localStorage:', e);
        allRecords = [];
      }
    }

    function generateId() {
      return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    function createRecord(recordData) {
      const newRecord = {
        id: generateId(),
        ...recordData
      };
      allRecords.push(newRecord);
      saveToLocalStorage();
      return newRecord;
    }

    function deleteRecord(id) {
      allRecords = allRecords.filter(r => r.id !== id);
      saveToLocalStorage();
    }

    function init() {
      loadFromLocalStorage();
      renderApp();
    }

    function renderApp() {
      const app = document.getElementById('app');
      
      const bgColor = config.background_color;
      const surfaceColor = config.surface_color;
      const textColor = config.text_color;
      const primaryColor = config.primary_action_color;
      const secondaryColor = config.secondary_action_color;
      const fontFamily = config.font_family;
      const baseSize = config.font_size;
      
      document.body.style.backgroundColor = bgColor;
      
      if (currentView === 'list') {
        app.innerHTML = `
          <div class="w-full min-h-full" style="background-color: ${bgColor}; color: ${textColor}; font-family: ${fontFamily}, sans-serif; padding: 20px;">
            <div class="max-w-6xl mx-auto">
              <div class="mb-6">
                <h1 style="font-size: ${baseSize * 2}px; font-weight: bold; margin-bottom: 8px;">üîß ${config.nombre_taller}</h1>
                <p style="font-size: ${baseSize * 0.9}px; color: ${textColor}; opacity: 0.7;">Gesti√≥n de Veh√≠culos y Reparaciones</p>
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <button id="btn-nuevo-vehiculo" style="background-color: ${primaryColor}; color: white; padding: 16px; border-radius: 12px; font-size: ${baseSize}px; font-weight: 600; transition: all 0.2s;">
                  üöó Registrar Veh√≠culo
                </button>
                <button id="btn-nueva-reparacion" style="background-color: ${primaryColor}; color: white; padding: 16px; border-radius: 12px; font-size: ${baseSize}px; font-weight: 600; transition: all 0.2s;">
                  üîß Nueva Reparaci√≥n
                </button>
                <button id="btn-agenda" style="background-color: ${primaryColor}; color: white; padding: 16px; border-radius: 12px; font-size: ${baseSize}px; font-weight: 600; transition: all 0.2s;">
                  üìÖ Agenda
                </button>
              </div>
              
              <div id="records-container" class="space-y-4"></div>
            </div>
          </div>
        `;
        
        const btnNuevoVehiculo = document.getElementById('btn-nuevo-vehiculo');
        const btnNuevaReparacion = document.getElementById('btn-nueva-reparacion');
        
        btnNuevoVehiculo.addEventListener('mouseenter', (e) => {
          e.target.style.transform = 'scale(1.02)';
          e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
        });
        btnNuevoVehiculo.addEventListener('mouseleave', (e) => {
          e.target.style.transform = 'scale(1)';
          e.target.style.boxShadow = 'none';
        });
        btnNuevaReparacion.addEventListener('mouseenter', (e) => {
          e.target.style.transform = 'scale(1.02)';
          e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
        });
        btnNuevaReparacion.addEventListener('mouseleave', (e) => {
          e.target.style.transform = 'scale(1)';
          e.target.style.boxShadow = 'none';
        });
        
        btnNuevoVehiculo.addEventListener('click', () => {
          currentView = 'form-vehiculo';
          currentRecord = null;
          renderApp();
        });
        
        btnNuevaReparacion.addEventListener('click', () => {
          currentView = 'form-reparacion';
          currentRecord = null;
          renderApp();
        });
        
        const btnAgenda = document.getElementById('btn-agenda');
        btnAgenda.addEventListener('mouseenter', (e) => {
          e.target.style.transform = 'scale(1.02)';
          e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
        });
        btnAgenda.addEventListener('mouseleave', (e) => {
          e.target.style.transform = 'scale(1)';
          e.target.style.boxShadow = 'none';
        });
        btnAgenda.addEventListener('click', () => {
          currentView = 'agenda';
          renderApp();
        });
        
        renderRecordsList();
      } else if (currentView === 'form-vehiculo') {
        renderVehiculoForm();
      } else if (currentView === 'form-reparacion') {
        renderReparacionForm();
      } else if (currentView === 'ticket') {
        renderTicket();
      } else if (currentView === 'agenda') {
        renderAgenda();
      }
    }

    function renderRecordsList() {
      const container = document.getElementById('records-container');
      const surfaceColor = config.surface_color;
      const textColor = config.text_color;
      const primaryColor = config.primary_action_color;
      const secondaryColor = config.secondary_action_color;
      const baseSize = config.font_size;
      
      if (allRecords.length === 0) {
        container.innerHTML = `
          <div style="background-color: ${surfaceColor}; padding: 48px; border-radius: 12px; text-align: center;">
            <div style="font-size: ${baseSize * 3}px; margin-bottom: 16px;">üìã</div>
            <p style="font-size: ${baseSize * 1.1}px; color: ${textColor}; opacity: 0.6;">No hay registros a√∫n</p>
            <p style="font-size: ${baseSize * 0.9}px; color: ${textColor}; opacity: 0.5; margin-top: 8px;">Comienza registrando un veh√≠culo o una reparacion</p>
          </div>
        `;
        return;
      }
      
      const vehiculos = allRecords.filter(r => r.tipo === 'vehiculo');
      const reparaciones = allRecords.filter(r => r.tipo === 'reparacion' && r.diagnostico && r.reparaciones);
      
      let html = '';
      
      if (vehiculos.length > 0) {
        html += `<div style="margin-bottom: 24px;">
          <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 600; margin-bottom: 16px; color: ${textColor};">üöó Veh√≠culos Registrados (${vehiculos.length})</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">`;
        
        vehiculos.forEach(record => {
          html += `
            <div class="record-card" data-id="${record.id}" style="background-color: ${surfaceColor}; padding: 20px; border-radius: 12px; border: 2px solid transparent; transition: all 0.2s;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <div>
                  <div style="font-size: ${baseSize * 1.2}px; font-weight: 600; color: ${textColor};">${record.placa}</div>
                  <div style="font-size: ${baseSize * 0.9}px; color: ${textColor}; opacity: 0.7; margin-top: 4px;">${record.marca} ${record.modelo} ${record.year}</div>
                </div>
                <button class="delete-btn" data-id="${record.id}" style="color: ${secondaryColor}; padding: 8px; border-radius: 8px; font-size: ${baseSize * 0.85}px;">üóëÔ∏è</button>
              </div>
              <div style="font-size: ${baseSize * 0.85}px; color: ${textColor}; opacity: 0.6;">
                <div>üé® ${record.color}</div>
                <div>üë§ ${record.cliente}</div>
                <div>üìû ${record.telefono}</div>
              </div>
            </div>
          `;
        });
        
        html += `</div></div>`;
      }
      
      if (reparaciones.length > 0) {
        html += `<div>
          <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 600; margin-bottom: 16px; color: ${textColor};">Reparaciones (${reparaciones.length})</h2>
          <div class="space-y-3">`;
        
        reparaciones.forEach(record => {
          const estadoColors = {
            'En Proceso': '#f59e0b',
            'Completada': '#10b981',
            'Pendiente': '#ef4444'
          };
          const estadoColor = estadoColors[record.estado] || '#6b7280';
          
          html += `
            <div class="record-card" data-id="${record.id}" style="background-color: ${surfaceColor}; padding: 20px; border-radius: 12px; border: 2px solid transparent; transition: all 0.2s;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <div style="flex: 1;">
                  <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                    <div style="font-size: ${baseSize * 1.1}px; font-weight: 600; color: ${textColor};">${record.placa} - ${record.marca} ${record.modelo}</div>
                    <span style="background-color: ${estadoColor}; color: white; padding: 4px 12px; border-radius: 16px; font-size: ${baseSize * 0.75}px; font-weight: 600;">${record.estado}</span>
                  </div>
                  <div style="font-size: ${baseSize * 0.85}px; color: ${textColor}; opacity: 0.7;">
                    üìÖ ${new Date(record.fecha).toLocaleDateString('es-ES')} | üë§ ${record.cliente} | üîß ${record.mecanico}
                  </div>
                  <div style="font-size: ${baseSize * 0.9}px; color: ${textColor}; margin-top: 8px;">${record.descripcion}</div>
                  <div style="font-size: ${baseSize * 1.1}px; font-weight: 600; color: ${primaryColor}; margin-top: 8px;">Total: $${record.total.toFixed(2)}</div>
                </div>
                <div style="display: flex; gap: 8px;">
                  <button class="ticket-btn" data-id="${record.id}" style="background-color: ${primaryColor}; color: white; padding: 8px 16px; border-radius: 8px; font-size: ${baseSize * 0.85}px; font-weight: 600;">üìÑ Ticket</button>
                  <button class="delete-btn" data-id="${record.id}" style="color: ${secondaryColor}; padding: 8px; border-radius: 8px; font-size: ${baseSize * 0.85}px;">üóëÔ∏è</button>
                </div>
              </div>
            </div>
          `;
        });
        
        html += `</div></div>`;
      }
      
      container.innerHTML = html;
      
      document.querySelectorAll('.record-card').forEach(card => {
        card.addEventListener('mouseenter', (e) => {
          e.currentTarget.style.borderColor = primaryColor;
          e.currentTarget.style.transform = 'translateY(-2px)';
          e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        });
        card.addEventListener('mouseleave', (e) => {
          e.currentTarget.style.borderColor = 'transparent';
          e.currentTarget.style.transform = 'translateY(0)';
          e.currentTarget.style.boxShadow = 'none';
        });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const id = e.currentTarget.getAttribute('data-id');
          
          const confirmBtn = e.currentTarget;
          const originalContent = confirmBtn.innerHTML;
          confirmBtn.innerHTML = '‚úì Confirmar';
          confirmBtn.style.backgroundColor = '#ef4444';
          confirmBtn.style.color = 'white';
          confirmBtn.style.padding = '8px 12px';
          
          const cancelTimeout = setTimeout(() => {
            confirmBtn.innerHTML = originalContent;
            confirmBtn.style.backgroundColor = 'transparent';
            confirmBtn.style.color = secondaryColor;
            confirmBtn.style.padding = '8px';
          }, 3000);
          
          const confirmHandler = () => {
            clearTimeout(cancelTimeout);
            deleteRecord(id);
            renderApp();
          };
          
          confirmBtn.onclick = confirmHandler;
        });
      });
      
      document.querySelectorAll('.ticket-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const id = e.currentTarget.getAttribute('data-id');
          currentRecord = allRecords.find(r => r.id === id);
          currentView = 'ticket';
          renderApp();
        });
      });
    }

    function renderVehiculoForm() {
      const app = document.getElementById('app');
      const bgColor = config.background_color;
      const surfaceColor = config.surface_color;
      const textColor = config.text_color;
      const primaryColor = config.primary_action_color;
      const secondaryColor = config.secondary_action_color;
      const fontFamily = config.font_family;
      const baseSize = config.font_size;
      
      app.innerHTML = `
        <div class="w-full min-h-full" style="background-color: ${bgColor}; color: ${textColor}; font-family: ${fontFamily}, sans-serif; padding: 20px;">
          <div class="max-w-2xl mx-auto">
            <div class="mb-6">
              <button id="btn-back" style="color: ${secondaryColor}; font-size: ${baseSize * 0.9}px; margin-bottom: 12px;">‚Üê Volver</button>
              <h1 style="font-size: ${baseSize * 1.8}px; font-weight: bold;">üöó Registrar Veh√≠culo</h1>
            </div>
            
            <form id="vehiculo-form" style="background-color: ${surfaceColor}; padding: 24px; border-radius: 12px;">
              <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label for="marca" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Marca *</label>
                    <input type="text" id="marca" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                  </div>
                  <div>
                    <label for="modelo" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Modelo *</label>
                    <input type="text" id="modelo" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                  </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label for="year" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">A√±o *</label>
                    <input type="text" id="year" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                  </div>
                  <div>
                    <label for="color" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Color *</label>
                    <input type="text" id="color" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                  </div>
                </div>
                
                <div>
                  <label for="cliente" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Cliente *</label>
                  <input type="text" id="cliente" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                </div>
                
                <div>
                  <label for="telefono" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Telefono *</label>
                  <input type="tel" id="telefono" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                </div>
              </div>
              
              <button type="submit" id="submit-btn" style="width: 100%; background-color: ${primaryColor}; color: white; padding: 16px; border-radius: 8px; font-size: ${baseSize * 1.1}px; font-weight: 600; margin-top: 24px; transition: all 0.2s;">
                Guardar Veh√≠culo
              </button>
            </form>
          </div>
        </div>
      `;
      
      document.getElementById('btn-back').addEventListener('click', () => {
        currentView = 'list';
        renderApp();
      });
      
      const submitBtn = document.getElementById('submit-btn');
      submitBtn.addEventListener('mouseenter', (e) => {
        e.target.style.transform = 'scale(1.02)';
      });
      submitBtn.addEventListener('mouseleave', (e) => {
        e.target.style.transform = 'scale(1)';
      });
      
      document.getElementById('vehiculo-form').addEventListener('submit', (e) => {
        e.preventDefault();
        
        const vehiculoData = {
          tipo: 'vehiculo',
          fecha: new Date().toISOString(),
          placa: `${document.getElementById('marca').value.substring(0, 3).toUpperCase()}-${Date.now().toString().slice(-4)}`,
          marca: document.getElementById('marca').value,
          modelo: document.getElementById('modelo').value,
          year: document.getElementById('year').value,
          color: document.getElementById('color').value,
          cliente: document.getElementById('cliente').value,
          telefono: document.getElementById('telefono').value,
          kilometraje: '',
          mecanico: '',
          descripcion: '',
          diagnostico: '',
          reparaciones: '',
          repuestos: '',
          manoObra: 0,
          costoRepuestos: 0,
          total: 0,
          estado: ''
        };
        
        createRecord(vehiculoData);
        currentView = 'list';
        renderApp();
      });
    }

    function renderReparacionForm() {
      const app = document.getElementById('app');
      const bgColor = config.background_color;
      const surfaceColor = config.surface_color;
      const textColor = config.text_color;
      const primaryColor = config.primary_action_color;
      const secondaryColor = config.secondary_action_color;
      const fontFamily = config.font_family;
      const baseSize = config.font_size;
      
      const vehiculos = allRecords.filter(r => r.tipo === 'vehiculo');
      
      app.innerHTML = `
        <div class="w-full min-h-full" style="background-color: ${bgColor}; color: ${textColor}; font-family: ${fontFamily}, sans-serif; padding: 20px;">
          <div class="max-w-3xl mx-auto">
            <div class="mb-6">
              <button id="btn-back" style="color: ${secondaryColor}; font-size: ${baseSize * 0.9}px; margin-bottom: 12px;">‚Üê Volver</button>
              <h1 style="font-size: ${baseSize * 1.8}px; font-weight: bold;">üîß Nueva Reparaci√≥n</h1>
            </div>
            
            ${vehiculos.length === 0 ? `
              <div style="background-color: ${surfaceColor}; padding: 32px; border-radius: 12px; text-align: center;">
                <div style="font-size: ${baseSize * 2}px; margin-bottom: 16px;"></div>
                <p style="font-size: ${baseSize * 1.1}px; color: ${textColor}; margin-bottom: 8px;">No hay veh√≠culos registrados</p>
                <p style="font-size: ${baseSize * 0.9}px; color: ${textColor}; opacity: 0.6;">Primero debes registrar un veh√≠culo antes de crear una reparaci√≥n</p>
                <button id="btn-registrar-vehiculo" style="background-color: ${primaryColor}; color: white; padding: 12px 24px; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; margin-top: 16px;">Registrar Veh√≠culo</button>
              </div>
            ` : `
            <form id="reparacion-form" style="background-color: ${surfaceColor}; padding: 24px; border-radius: 12px;">
              <div class="space-y-4">
                <div>
                  <label for="vehiculo-select" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Seleccionar Veh√≠culo *</label>
                  <select id="vehiculo-select" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                    <option value="">-- Seleccione un veh√≠culo --</option>
                    ${vehiculos.map(v => `
                      <option value="${v.id}">${v.placa} - ${v.marca} ${v.modelo} (${v.cliente})</option>
                    `).join('')}
                  </select>
                </div>
                
                <div id="vehiculo-info" style="display: none; background-color: ${bgColor}; padding: 16px; border-radius: 8px; font-size: ${baseSize * 0.9}px;">
                  <div style="font-weight: 600; margin-bottom: 8px; color: ${textColor};">Datos del Veh√≠culo</div>
                  <div id="vehiculo-details" style="color: ${textColor}; opacity: 0.8;"></div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label for="fecha" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Fecha *</label>
                    <input type="date" id="fecha" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                  </div>
                  <div>
                    <label for="mecanico" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Mec√°nico *</label>
                    <input type="text" id="mecanico" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                  </div>
                </div>
                
                <div>
                  <label for="descripcion" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Descripci√≥n del Problema *</label>
                  <textarea id="descripcion" required rows="3" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};"></textarea>
                </div>
                
                <div>
                  <label for="diagnostico" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Diagn√≥stico *</label>
                  <textarea id="diagnostico" required rows="3" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};"></textarea>
                </div>
                
                <div>
                  <label for="reparaciones" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Reparaciones Realizadas *</label>
                  <textarea id="reparaciones" required rows="3" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};"></textarea>
                </div>
                
                <div>
                  <label for="repuestos" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Repuestos Utilizados</label>
                  <textarea id="repuestos" rows="2" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};"></textarea>
                </div>
                
                <div class="grid grid-cols-3 gap-4">
                  <div>
                    <label for="manoObra" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Mano de Obra *</label>
                    <input type="number" id="manoObra" required step="0.01" min="0" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                  </div>
                  <div>
                    <label for="costoRepuestos" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Costo Repuestos</label>
                    <input type="number" id="costoRepuestos" step="0.01" min="0" value="0" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                  </div>
                  <div>
                    <label for="estado" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Estado *</label>
                    <select id="estado" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
                      <option value="Pendiente">Pendiente</option>
                      <option value="En Proceso">En Proceso</option>
                      <option value="Completada">Completada</option>
                    </select>
                  </div>
                </div>
                
                <div style="background-color: ${bgColor}; padding: 16px; border-radius: 8px;">
                  <div style="font-size: ${baseSize * 0.9}px; font-weight: 600; color: ${textColor}; margin-bottom: 8px;">Total a Pagar</div>
                  <div id="total-display" style="font-size: ${baseSize * 2}px; font-weight: bold; color: ${primaryColor};">$0.00</div>
                </div>
              </div>
              
              <button type="submit" id="submit-btn" style="width: 100%; background-color: ${primaryColor}; color: white; padding: 16px; border-radius: 8px; font-size: ${baseSize * 1.1}px; font-weight: 600; margin-top: 24px; transition: all 0.2s;">
                Guardar Reparaci√≥n
              </button>
            </form>
            `}
          </div>
        </div>
      `;
      
      document.getElementById('btn-back').addEventListener('click', () => {
        currentView = 'list';
        renderApp();
      });
      
      if (vehiculos.length === 0) {
        const btnRegistrar = document.getElementById('btn-registrar-vehiculo');
        if (btnRegistrar) {
          btnRegistrar.addEventListener('click', () => {
            currentView = 'form-vehiculo';
            renderApp();
          });
        }
        return;
      }
      
      const fechaInput = document.getElementById('fecha');
      fechaInput.valueAsDate = new Date();
      
      const vehiculoSelect = document.getElementById('vehiculo-select');
      const vehiculoInfo = document.getElementById('vehiculo-info');
      const vehiculoDetails = document.getElementById('vehiculo-details');
      
      vehiculoSelect.addEventListener('change', (e) => {
        const selectedId = e.target.value;
        if (selectedId) {
          const vehiculo = vehiculos.find(v => v.id === selectedId);
          if (vehiculo) {
            vehiculoInfo.style.display = 'block';
            vehiculoDetails.innerHTML = `
              <div>üìã Placa: <strong>${vehiculo.placa}</strong></div>
              <div>üöó ${vehiculo.marca} ${vehiculo.modelo} (${vehiculo.year})</div>
              <div>üé® Color: ${vehiculo.color}</div>
              <div>üë§ Cliente: ${vehiculo.cliente}</div>
              <div>üìû Tel√©fono: ${vehiculo.telefono}</div>
            `;
          }
        } else {
          vehiculoInfo.style.display = 'none';
        }
      });
      
      function updateTotal() {
        const manoObra = parseFloat(document.getElementById('manoObra').value) || 0;
        const costoRepuestos = parseFloat(document.getElementById('costoRepuestos').value) || 0;
        const total = manoObra + costoRepuestos;
        document.getElementById('total-display').textContent = `$${total.toFixed(2)}`;
      }
      
      document.getElementById('manoObra').addEventListener('input', updateTotal);
      document.getElementById('costoRepuestos').addEventListener('input', updateTotal);
      
      const submitBtn = document.getElementById('submit-btn');
      submitBtn.addEventListener('mouseenter', (e) => {
        e.target.style.transform = 'scale(1.02)';
      });
      submitBtn.addEventListener('mouseleave', (e) => {
        e.target.style.transform = 'scale(1)';
      });
      
      document.getElementById('reparacion-form').addEventListener('submit', (e) => {
        e.preventDefault();
        
        const selectedVehiculo = vehiculos.find(v => v.id === vehiculoSelect.value);
        
        if (!selectedVehiculo) {
          return;
        }
        
        const manoObra = parseFloat(document.getElementById('manoObra').value) || 0;
        const costoRepuestos = parseFloat(document.getElementById('costoRepuestos').value) || 0;
        
        const reparacionData = {
          tipo: 'reparacion',
          fecha: new Date(document.getElementById('fecha').value).toISOString(),
          placa: selectedVehiculo.placa,
          marca: selectedVehiculo.marca,
          modelo: selectedVehiculo.modelo,
          year: selectedVehiculo.year,
          color: selectedVehiculo.color,
          cliente: selectedVehiculo.cliente,
          telefono: selectedVehiculo.telefono,
          mecanico: document.getElementById('mecanico').value,
          descripcion: document.getElementById('descripcion').value,
          diagnostico: document.getElementById('diagnostico').value,
          reparaciones: document.getElementById('reparaciones').value,
          repuestos: document.getElementById('repuestos').value,
          manoObra: manoObra,
          costoRepuestos: costoRepuestos,
          total: manoObra + costoRepuestos,
          estado: document.getElementById('estado').value,
          kilometraje: ''
        };
        
        createRecord(reparacionData);
        currentView = 'list';
        renderApp();
      });
    }

    let selectedMonth = new Date().getMonth();
    let selectedYear = new Date().getFullYear();

    function renderAgenda() {
      const app = document.getElementById('app');
      const bgColor = config.background_color;
      const surfaceColor = config.surface_color;
      const textColor = config.text_color;
      const primaryColor = config.primary_action_color;
      const secondaryColor = config.secondary_action_color;
      const fontFamily = config.font_family;
      const baseSize = config.font_size;
      
      const today = new Date();
      const currentMonth = selectedMonth;
      const currentYear = selectedYear;
      
      // Obtener todas las reparaciones
      const reparaciones = allRecords.filter(r => r.tipo === 'reparacion');
      
      // Agrupar reparaciones por fecha (sin ajuste de zona horaria)
      const reparacionesPorFecha = {};
      reparaciones.forEach(rep => {
        // Extraer solo la fecha en formato YYYY-MM-DD directamente
        const fecha = rep.fecha.split('T')[0];
        if (!reparacionesPorFecha[fecha]) {
          reparacionesPorFecha[fecha] = [];
        }
        reparacionesPorFecha[fecha].push(rep);
      });
      
      // Filtrar reparaciones pendientes y en proceso
      const reparacionesPendientes = reparaciones.filter(r => 
        r.estado === 'Pendiente' || r.estado === 'En Proceso'
      ).sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
      
      // Generar d√≠as del mes
      const firstDay = new Date(currentYear, currentMonth, 1);
      const lastDay = new Date(currentYear, currentMonth + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();
      
      const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                          'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
      
      let calendarHTML = '';
      let dayCounter = 1;
      
      // Generar 6 semanas (m√°ximo necesario para cualquier mes)
      for (let week = 0; week < 6; week++) {
        calendarHTML += '<div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 4px;">';
        
        for (let day = 0; day < 7; day++) {
          const cellIndex = week * 7 + day;
          
          if (cellIndex < startingDayOfWeek || dayCounter > daysInMonth) {
            calendarHTML += `<div style="padding: 8px; min-height: 60px; background-color: ${bgColor}; border-radius: 6px; opacity: 0.3;"></div>`;
          } else {
            const currentDate = new Date(currentYear, currentMonth, dayCounter);
            const dateStr = currentDate.toISOString().split('T')[0];
            const isToday = dayCounter === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear();
            const hasEvents = reparacionesPorFecha[dateStr];
            
            calendarHTML += `
              <div style="padding: 8px; min-height: 60px; background-color: ${surfaceColor}; border-radius: 6px; border: 2px solid ${isToday ? primaryColor : 'transparent'}; position: relative; cursor: pointer;" class="calendar-day" data-date="${dateStr}">
                <div style="font-size: ${baseSize * 0.75}px; font-weight: ${isToday ? 'bold' : 'normal'}; color: ${isToday ? primaryColor : textColor}; margin-bottom: 4px;">
                  ${dayCounter}
                </div>
                ${hasEvents ? `
                  <div style="display: flex; flex-wrap: wrap; gap: 2px;">
                    ${hasEvents.slice(0, 2).map(rep => {
                      const estadoColors = {
                        'En Proceso': '#f59e0b',
                        'Completada': '#10b981',
                        'Pendiente': '#ef4444'
                      };
                      return `<div style="width: 6px; height: 6px; border-radius: 50%; background-color: ${estadoColors[rep.estado]};"></div>`;
                    }).join('')}
                    ${hasEvents.length > 2 ? `<div style="font-size: 8px; color: ${textColor};">+${hasEvents.length - 2}</div>` : ''}
                  </div>
                ` : ''}
              </div>
            `;
            dayCounter++;
          }
        }
        
        calendarHTML += '</div>';
        
        if (dayCounter > daysInMonth) break;
      }
      
      app.innerHTML = `
        <div class="w-full min-h-full" style="background-color: ${bgColor}; color: ${textColor}; font-family: ${fontFamily}, sans-serif; padding: 20px;">
          <div class="max-w-6xl mx-auto">
            <div class="mb-6">
              <button id="btn-back" style="color: ${secondaryColor}; font-size: ${baseSize * 0.9}px; margin-bottom: 12px;">‚Üê Volver</button>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <h1 style="font-size: ${baseSize * 2}px; font-weight: bold;">üìÖ Agenda de Reparaciones</h1>
              </div>
              <div style="display: flex; align-items: center; gap: 16px;">
                <button id="btn-prev-month" style="background-color: ${surfaceColor}; color: ${textColor}; padding: 8px 16px; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; border: 2px solid ${primaryColor};">‚Üê Mes Anterior</button>
                <div style="display: flex; gap: 12px; align-items: center;">
                  <select id="month-select" style="padding: 8px 12px; border: 2px solid ${primaryColor}; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor}; background-color: ${surfaceColor}; font-weight: 600;">
                    ${monthNames.map((name, idx) => `<option value="${idx}" ${idx === currentMonth ? 'selected' : ''}>${name}</option>`).join('')}
                  </select>
                  <input type="number" id="year-input" value="${currentYear}" min="2000" max="2100" style="width: 100px; padding: 8px 12px; border: 2px solid ${primaryColor}; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor}; background-color: ${surfaceColor}; font-weight: 600;">
                </div>
                <button id="btn-next-month" style="background-color: ${surfaceColor}; color: ${textColor}; padding: 8px 16px; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; border: 2px solid ${primaryColor};">Mes Siguiente ‚Üí</button>
                <button id="btn-today" style="background-color: ${primaryColor}; color: white; padding: 8px 16px; border-radius: 8px; font-size: ${baseSize * 0.9}px; font-weight: 600; cursor: pointer;">Hoy</button>
              </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <!-- Calendario -->
              <div class="lg:col-span-2" style="background-color: ${surfaceColor}; padding: 20px; border-radius: 12px;">
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 12px;">
                  ${['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'Sab'].map(day => 
                    `<div style="text-align: center; font-size: ${baseSize * 0.85}px; font-weight: 600; color: ${textColor}; padding: 8px;">${day}</div>`
                  ).join('')}
                </div>
                
                ${calendarHTML}
              </div>
              
              <!-- Panel de pr√≥ximas reparaciones -->
              <div style="background-color: ${surfaceColor}; padding: 20px; border-radius: 12px; height: fit-content;">
                <h2 style="font-size: ${baseSize * 1.3}px; font-weight: 600; margin-bottom: 16px; color: ${textColor};">üîî Pr√≥ximas Reparaciones</h2>
                
                ${reparacionesPendientes.length === 0 ? `
                  <div style="text-align: center; padding: 32px 0;">
                    <div style="font-size: ${baseSize * 2}px; margin-bottom: 12px;">‚úÖ</div>
                    <p style="font-size: ${baseSize * 0.9}px; color: ${textColor}; opacity: 0.6;">No hay reparaciones pendientes</p>
                  </div>
                ` : `
                  <div class="space-y-3" style="max-height: 500px; overflow-y: auto;">
                    ${reparacionesPendientes.map(rep => {
                      const estadoColors = {
                        'En Proceso': '#f59e0b',
                        'Completada': '#10b981',
                        'Pendiente': '#ef4444'
                      };
                      const diasRestantes = Math.ceil((new Date(rep.fecha) - today) / (1000 * 60 * 60 * 24));
                      const esUrgente = diasRestantes <= 3 && diasRestantes >= 0;
                      
                      return `
                        <div style="padding: 12px; background-color: ${bgColor}; border-radius: 8px; border-left: 4px solid ${estadoColors[rep.estado]};">
                          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 6px;">
                            <div style="font-size: ${baseSize * 0.9}px; font-weight: 600; color: ${textColor};">${rep.placa}</div>
                            ${esUrgente ? `<span style="background-color: #ef4444; color: white; padding: 2px 8px; border-radius: 12px; font-size: ${baseSize * 0.7}px;">¬°Pr√≥ximo!</span>` : ''}
                          </div>
                          <div style="font-size: ${baseSize * 0.8}px; color: ${textColor}; opacity: 0.8; margin-bottom: 4px;">
                            ${rep.marca} ${rep.modelo}
                          </div>
                          <div style="font-size: ${baseSize * 0.75}px; color: ${textColor}; opacity: 0.7; margin-bottom: 4px;">
                            üë§ ${rep.cliente}
                          </div>
                          <div style="font-size: ${baseSize * 0.75}px; color: ${textColor}; opacity: 0.7; margin-bottom: 4px;">
                            üìÖ ${new Date(rep.fecha).toLocaleDateString('es-ES')}
                          </div>
                          <div style="font-size: ${baseSize * 0.8}px; color: ${textColor}; margin-top: 6px;">
                            ${rep.descripcion.substring(0, 60)}${rep.descripcion.length > 60 ? '...' : ''}
                          </div>
                        </div>
                      `;
                    }).join('')}
                  </div>
                `}
              </div>
            </div>
            
            <!-- Modal de detalles del d√≠a -->
            <div id="day-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; padding: 20px;">
              <div style="background-color: ${surfaceColor}; padding: 24px; border-radius: 12px; max-width: 600px; width: 100%; max-height: 80%; overflow-y: auto; position: relative;">
                <button id="close-modal" style="position: absolute; top: 16px; right: 16px; font-size: ${baseSize * 1.5}px; color: ${secondaryColor}; background: none; border: none; cursor: pointer;">√ó</button>
                <div id="modal-content"></div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('btn-back').addEventListener('click', () => {
        currentView = 'list';
        renderApp();
      });
      
      // Navegaci√≥n del calendario
      document.getElementById('btn-prev-month').addEventListener('click', () => {
        selectedMonth--;
        if (selectedMonth < 0) {
          selectedMonth = 11;
          selectedYear--;
        }
        renderApp();
      });
      
      document.getElementById('btn-next-month').addEventListener('click', () => {
        selectedMonth++;
        if (selectedMonth > 11) {
          selectedMonth = 0;
          selectedYear++;
        }
        renderApp();
      });
      
      document.getElementById('btn-today').addEventListener('click', () => {
        const now = new Date();
        selectedMonth = now.getMonth();
        selectedYear = now.getFullYear();
        renderApp();
      });
      
      document.getElementById('month-select').addEventListener('change', (e) => {
        selectedMonth = parseInt(e.target.value);
        renderApp();
      });
      
      document.getElementById('year-input').addEventListener('change', (e) => {
        const year = parseInt(e.target.value);
        if (year >= 2000 && year <= 2100) {
          selectedYear = year;
          renderApp();
        }
      });
      
      // Agregar eventos a los d√≠as del calendario
      document.querySelectorAll('.calendar-day').forEach(dayEl => {
        dayEl.addEventListener('click', (e) => {
          const dateStr = e.currentTarget.getAttribute('data-date');
          const reparacionesDelDia = reparacionesPorFecha[dateStr];
          
          if (reparacionesDelDia && reparacionesDelDia.length > 0) {
            showDayModal(dateStr, reparacionesDelDia);
          } else if (dateStr) {
            showReminderForm(dateStr);
          }
        });
        
        dayEl.addEventListener('mouseenter', (e) => {
          const dateStr = e.currentTarget.getAttribute('data-date');
          if (dateStr) {
            e.currentTarget.style.transform = 'scale(1.05)';
            e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
          }
        });
        
        dayEl.addEventListener('mouseleave', (e) => {
          e.currentTarget.style.transform = 'scale(1)';
          e.currentTarget.style.boxShadow = 'none';
        });
      });
      
      function showReminderForm(dateStr) {
        const modal = document.getElementById('day-modal');
        const modalContent = document.getElementById('modal-content');
        const fecha = new Date(dateStr + 'T12:00:00');
        const vehiculos = allRecords.filter(r => r.tipo === 'vehiculo');
        
        modalContent.innerHTML = `
          <h3 style="font-size: ${baseSize * 1.5}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">
            üìÖ Nuevo Recordatorio
          </h3>
          <p style="font-size: ${baseSize * 0.9}px; color: ${textColor}; opacity: 0.7; margin-bottom: 16px;">
            ${fecha.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
          </p>
          
          <form id="reminder-form" style="margin-top: 16px;">
            <div style="margin-bottom: 16px;">
              <label for="reminder-vehiculo" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Veh√≠culo *</label>
              <select id="reminder-vehiculo" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor}; background-color: white;">
                <option value="">-- Seleccione un veh√≠culo --</option>
                ${vehiculos.map(v => `
                  <option value="${v.id}">${v.placa} - ${v.marca} ${v.modelo} (${v.cliente})</option>
                `).join('')}
              </select>
            </div>
            
            <div id="vehiculo-info-reminder" style="display: none; background-color: ${bgColor}; padding: 12px; border-radius: 8px; font-size: ${baseSize * 0.85}px; margin-bottom: 16px;">
              <div id="vehiculo-details-reminder" style="color: ${textColor}; opacity: 0.8;"></div>
            </div>
            
            <div style="margin-bottom: 16px;">
              <label for="reminder-mecanico" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Mec√°nico Asignado *</label>
              <input type="text" id="reminder-mecanico" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor};">
            </div>
            
            <div style="margin-bottom: 16px;">
              <label for="reminder-descripcion" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Descripci√≥n del Servicio *</label>
              <textarea id="reminder-descripcion" required rows="3" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor}; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-bottom: 16px;">
              <label for="reminder-diagnostico" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Diagn√≥stico/Notas</label>
              <textarea id="reminder-diagnostico" rows="2" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor}; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-bottom: 16px;">
              <label for="reminder-estado" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 8px; color: ${textColor};">Estado *</label>
              <select id="reminder-estado" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${textColor}; background-color: white;">
                <option value="Pendiente">Pendiente</option>
                <option value="En Proceso">En Proceso</option>
                <option value="Completada">Completada</option>
              </select>
            </div>
            
            <div style="display: flex; gap: 12px;">
              <button type="button" id="cancel-reminder" style="flex: 1; background-color: ${secondaryColor}; color: white; padding: 12px; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer;">
                Cancelar
              </button>
              <button type="submit" style="flex: 1; background-color: ${primaryColor}; color: white; padding: 12px; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer;">
                Guardar Recordatorio
              </button>
            </div>
          </form>
        `;
        
        modal.style.display = 'flex';
        
        // Manejo de selecci√≥n de veh√≠culo
        const vehiculoSelect = document.getElementById('reminder-vehiculo');
        const vehiculoInfo = document.getElementById('vehiculo-info-reminder');
        const vehiculoDetails = document.getElementById('vehiculo-details-reminder');
        
        vehiculoSelect.addEventListener('change', (e) => {
          const selectedId = e.target.value;
          if (selectedId) {
            const vehiculo = vehiculos.find(v => v.id === selectedId);
            if (vehiculo) {
              vehiculoInfo.style.display = 'block';
              vehiculoDetails.innerHTML = `
                <div>üìã Placa: <strong>${vehiculo.placa}</strong></div>
                <div>üöó ${vehiculo.marca} ${vehiculo.modelo} (${vehiculo.year})</div>
                <div>üë§ Cliente: ${vehiculo.cliente}</div>
                <div>üìû ${vehiculo.telefono}</div>
              `;
            }
          } else {
            vehiculoInfo.style.display = 'none';
          }
        });
        
        // Manejo de cancelaci√≥n
        document.getElementById('cancel-reminder').addEventListener('click', () => {
          modal.style.display = 'none';
        });
        
        // Manejo de env√≠o del formulario
        document.getElementById('reminder-form').addEventListener('submit', (e) => {
          e.preventDefault();
          
          const selectedVehiculo = vehiculos.find(v => v.id === vehiculoSelect.value);
          
          if (!selectedVehiculo) {
            return;
          }
          
          const reparacionData = {
            tipo: 'reparacion',
            fecha: new Date(dateStr + 'T12:00:00').toISOString(),
            placa: selectedVehiculo.placa,
            marca: selectedVehiculo.marca,
            modelo: selectedVehiculo.modelo,
            year: selectedVehiculo.year,
            color: selectedVehiculo.color,
            cliente: selectedVehiculo.cliente,
            telefono: selectedVehiculo.telefono,
            mecanico: document.getElementById('reminder-mecanico').value,
            descripcion: document.getElementById('reminder-descripcion').value,
            diagnostico: document.getElementById('reminder-diagnostico').value || '',
            reparaciones: '',
            repuestos: '',
            manoObra: 0,
            costoRepuestos: 0,
            total: 0,
            estado: document.getElementById('reminder-estado').value,
            kilometraje: ''
          };
          
          createRecord(reparacionData);
          modal.style.display = 'none';
          
          // Volver a renderizar la agenda para mostrar el nuevo recordatorio
          renderApp();
        });
      }
      
      function showDayModal(dateStr, reparaciones) {
        const modal = document.getElementById('day-modal');
        const modalContent = document.getElementById('modal-content');
        const fecha = new Date(dateStr + 'T12:00:00');
        
        modalContent.innerHTML = `
          <h3 style="font-size: ${baseSize * 1.5}px; font-weight: 600; margin-bottom: 16px; color: ${textColor};">
            üìÖ ${fecha.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
          </h3>
          
          <div style="font-size: ${baseSize * 0.9}px; color: ${textColor}; margin-bottom: 16px; opacity: 0.7;">
            ${reparaciones.length} ${reparaciones.length === 1 ? 'reparaci√≥n programada' : 'reparaciones programadas'}
          </div>
          
          <div class="space-y-3">
            ${reparaciones.map(rep => {
              const estadoColors = {
                'En Proceso': '#f59e0b',
                'Completada': '#10b981',
                'Pendiente': '#ef4444'
              };
              
              return `
                <div style="padding: 16px; background-color: ${bgColor}; border-radius: 8px; border-left: 4px solid ${estadoColors[rep.estado]};">
                  <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                    <div>
                      <div style="font-size: ${baseSize * 1.1}px; font-weight: 600; color: ${textColor}; margin-bottom: 4px;">
                        ${rep.placa} - ${rep.marca} ${rep.modelo}
                      </div>
                      <span style="background-color: ${estadoColors[rep.estado]}; color: white; padding: 4px 12px; border-radius: 16px; font-size: ${baseSize * 0.75}px; font-weight: 600;">
                        ${rep.estado}
                      </span>
                    </div>
                  </div>
                  
                  <div style="font-size: ${baseSize * 0.85}px; color: ${textColor}; opacity: 0.8; margin-top: 8px;">
                    <div style="margin-bottom: 4px;">üë§ Cliente: ${rep.cliente}</div>
                    <div style="margin-bottom: 4px;">üìû Tel√©fono: ${rep.telefono}</div>
                    <div style="margin-bottom: 4px;">üîß Mec√°nico: ${rep.mecanico}</div>
                    <div style="margin-bottom: 8px;">üí∞ Total: $${rep.total.toFixed(2)}</div>
                  </div>
                  
                  <div style="font-size: ${baseSize * 0.85}px; color: ${textColor}; margin-top: 8px; padding-top: 8px; border-top: 1px solid ${textColor}33;">
                    <strong>Descripci√≥n:</strong> ${rep.descripcion}
                  </div>
                  
                  <button class="ver-ticket-btn" data-id="${rep.id}" style="width: 100%; margin-top: 12px; background-color: ${primaryColor}; color: white; padding: 10px; border-radius: 8px; font-size: ${baseSize * 0.85}px; font-weight: 600; cursor: pointer;">
                    üìÑ Ver Ticket Completo
                  </button>
                </div>
              `;
            }).join('')}
          </div>
        `;
        
        modal.style.display = 'flex';
        
        document.querySelectorAll('.ver-ticket-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const id = e.currentTarget.getAttribute('data-id');
            currentRecord = allRecords.find(r => r.id === id);
            currentView = 'ticket';
            renderApp();
          });
        });
      }
      
      document.getElementById('close-modal').addEventListener('click', () => {
        document.getElementById('day-modal').style.display = 'none';
      });
      
      document.getElementById('day-modal').addEventListener('click', (e) => {
        if (e.target.id === 'day-modal') {
          document.getElementById('day-modal').style.display = 'none';
        }
      });
    }

    function renderTicket() {
      const app = document.getElementById('app');
      const bgColor = config.background_color;
      const secondaryColor = config.secondary_action_color;
      const primaryColor = config.primary_action_color;
      const fontFamily = config.font_family;
      const baseSize = config.font_size;
      
      if (!currentRecord) {
        currentView = 'list';
        renderApp();
        return;
      }
      
      app.innerHTML = `
        <div class="w-full min-h-full" style="background-color: ${bgColor}; padding: 20px; font-family: ${fontFamily}, sans-serif;">
          <div class="max-w-4xl mx-auto">
            <div class="mb-6">
              <button id="btn-back" style="color: ${secondaryColor}; font-size: ${baseSize * 0.9}px; margin-bottom: 12px;">‚Üê Volver</button>
              
            </div>
            
            <div id="ticket-print" style="background-color: white; color: #000; max-width: 320px; margin: 0 auto; padding: 20px; font-family: 'Courier New', monospace; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px;">
              <div style="text-align: center; border-bottom: 2px dashed #000; padding-bottom: 10px; margin-bottom: 10px;">
                <div style="font-size: 16px; font-weight: bold; margin-bottom: 4px;">${config.nombre_taller}</div>
                <div style="font-size: 10px; margin-bottom: 2px;">${config.direccion_taller}</div>
                <div style="font-size: 10px;">Tel: ${config.telefono_taller}</div>
              </div>
              
              <div style="text-align: center; margin-bottom: 10px;">
                <div style="font-size: 13px; font-weight: bold;">ORDEN DE REPARACI√ìN</div>
                <div style="font-size: 10px; margin-top: 2px;">Fecha: ${new Date(currentRecord.fecha).toLocaleDateString('es-ES')}</div>
              </div>
              
              <div style="border-bottom: 1px dashed #000; padding-bottom: 8px; margin-bottom: 8px;">
                <div style="margin-bottom: 4px; font-size: 11px;"><strong>DATOS DEL CLIENTE</strong></div>
                <div style="font-size: 10px;">Cliente: ${currentRecord.cliente}</div>
                <div style="font-size: 10px;">Tel√©fono: ${currentRecord.telefono}</div>
              </div>
              
              <div style="border-bottom: 1px dashed #000; padding-bottom: 8px; margin-bottom: 8px;">
                <div style="margin-bottom: 4px; font-size: 11px;"><strong>DATOS DEL VEH√çCULO</strong></div>
                <div style="font-size: 10px;">Placa: ${currentRecord.placa}</div>
                <div style="font-size: 10px;">Marca: ${currentRecord.marca}</div>
                <div style="font-size: 10px;">Modelo: ${currentRecord.modelo}</div>
                <div style="font-size: 10px;">A√±o: ${currentRecord.year}</div>
                <div style="font-size: 10px;">Color: ${currentRecord.color}</div>
              </div>
              
              <div style="border-bottom: 1px dashed #000; padding-bottom: 8px; margin-bottom: 8px;">
                <div style="margin-bottom: 4px; font-size: 11px;"><strong>SERVICIO REALIZADO</strong></div>
                <div style="font-size: 10px; margin-bottom: 4px;"><strong>Problema:</strong></div>
                <div style="font-size: 10px; margin-bottom: 6px;">${currentRecord.descripcion}</div>
                <div style="font-size: 10px; margin-bottom: 4px;"><strong>Diagn√≥stico:</strong></div>
                <div style="font-size: 10px; margin-bottom: 6px;">${currentRecord.diagnostico}</div>
                <div style="font-size: 10px; margin-bottom: 4px;"><strong>Reparaciones:</strong></div>
                <div style="font-size: 10px;">${currentRecord.reparaciones}</div>
              </div>
              
              ${currentRecord.repuestos ? `
              <div style="border-bottom: 1px dashed #000; padding-bottom: 8px; margin-bottom: 8px;">
                <div style="margin-bottom: 4px; font-size: 11px;"><strong>REPUESTOS</strong></div>
                <div style="font-size: 10px;">${currentRecord.repuestos}</div>
              </div>
              ` : ''}
              
              <div style="border-bottom: 2px dashed #000; padding-bottom: 8px; margin-bottom: 8px;">
                <div style="margin-bottom: 4px; font-size: 11px;"><strong>DETALLE DE COSTOS</strong></div>
                <div style="display: flex; justify-content: space-between; font-size: 10px; margin-bottom: 3px;">
                  <span>Mano de Obra:</span>
                  <span>$${currentRecord.manoObra.toFixed(2)}</span>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 10px; margin-bottom: 3px;">
                  <span>Repuestos:</span>
                  <span>$${currentRecord.costoRepuestos.toFixed(2)}</span>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 14px; font-weight: bold; margin-top: 6px;">
                  <span>TOTAL:</span>
                  <span>$${currentRecord.total.toFixed(2)}</span>
                </div>
              </div>
              
              <div style="margin-bottom: 10px;">
                <div style="font-size: 10px;">Mec√°nico: ${currentRecord.mecanico}</div>
                <div style="font-size: 10px;">Estado: ${currentRecord.estado}</div>
              </div>
              
              <div style="text-align: center; font-size: 9px; color: #666; margin-top: 10px;">
                <div>¬°Gracias por su confianza!</div>
                <div style="margin-top: 4px;">Este documento es un comprobante de servicio</div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('btn-back').addEventListener('click', () => {
        currentView = 'list';
        currentRecord = null;
        renderApp();
      });
      
      document.getElementById('btn-print').addEventListener('click', () => {
        window.print();
      });
    }

    // Iniciar la aplicaci√≥n cuando el DOM esta listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b84cf5010d39925',t:'MTc2NzQ2NzU2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
